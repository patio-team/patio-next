'use client';

import { Session } from '@/lib/auth';
import { Avatar, AvatarFallback, AvatarImage } from '../ui/avatar';
import { ChevronDown } from 'lucide-react';
import { signOut as authSignOut } from '@/lib/auth-client';
import {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
} from '../ui/dropdown-menu';
import { User, LogOut, CirclePlus } from 'lucide-react';
import { TeamMemberWithTeam } from '@/db/schema';
import Link from 'next/link';
import { redirect } from 'next/navigation';
import { Button } from '../ui/button';

export interface User {
  id: string;
  name: string;
  email: string;
  image: string;
}

export interface PageHeaderProps {
  user: Session['user'];
  userTeams: TeamMemberWithTeam[];
}

export default function PageHeader({ user, userTeams }: PageHeaderProps) {
  const signOut = () => {
    authSignOut();
    redirect('/login');
  };

  return (
    <header className="w-full h-20 bg-white shadow-sm border-b border-gray-100 flex items-center justify-between px-4 md:px-16">
      {/* Logo */}
      <div className="flex items-center">
        <svg
          width="108"
          height="42"
          viewBox="0 0 108 42"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M108 20.2189C108 22.6139 107.457 24.7694 106.37 26.6854C105.283 28.5715 103.788 30.0384 101.886 31.0862C100.014 32.134 97.9461 32.6579 95.6817 32.6579C93.3871 32.6579 91.3039 32.134 89.432 31.0862C87.5601 30.0384 86.0807 28.5715 84.9938 26.6854C83.9068 24.7694 83.3634 22.6139 83.3634 20.2189C83.3634 17.8238 83.9068 15.6833 84.9938 13.7972C86.0807 11.8812 87.5601 10.3993 89.432 9.3515C91.3039 8.27374 93.3871 7.73486 95.6817 7.73486C97.9461 7.73486 100.014 8.27374 101.886 9.3515C103.788 10.3993 105.283 11.8812 106.37 13.7972C107.457 15.6833 108 17.8238 108 20.2189ZM102.565 20.2189C102.565 18.7519 102.248 17.4496 101.614 16.312C101.011 15.1444 100.18 14.2463 99.1236 13.6176C98.0971 12.9889 96.9498 12.6746 95.6817 12.6746C94.4136 12.6746 93.2513 12.9889 92.1945 13.6176C91.168 14.2463 90.3377 15.1444 89.7037 16.312C89.0999 17.4496 88.7979 18.7519 88.7979 20.2189C88.7979 21.6858 89.0999 22.9881 89.7037 24.1257C90.3377 25.2633 91.168 26.1465 92.1945 26.7752C93.2513 27.4039 94.4136 27.7182 95.6817 27.7182C96.9498 27.7182 98.0971 27.4039 99.1236 26.7752C100.18 26.1465 101.011 25.2633 101.614 24.1257C102.248 22.9881 102.565 21.6858 102.565 20.2189Z"
            fill="#3FE3D2"
          />
          <path
            d="M79.35 29.6288C79.35 30.4081 79.0931 31.0675 78.5793 31.607C78.0655 32.1166 77.4157 32.3714 76.6299 32.3714C75.8441 32.3714 75.1943 32.1166 74.6805 31.607C74.1667 31.0675 73.9098 30.4081 73.9098 29.6288V10.4607C73.9098 9.68143 74.1667 9.037 74.6805 8.52745C75.1943 7.98793 75.8441 7.71817 76.6299 7.71817C77.4157 7.71817 78.0655 7.98793 78.5793 8.52745C79.0931 9.037 79.35 9.68143 79.35 10.4607V29.6288Z"
            fill="#98DDAB"
          />
          <path
            d="M73.9125 2.69761C73.9125 1.20776 75.1304 0 76.6326 0C78.1349 0 79.3528 1.20776 79.3528 2.69761V3.59682C79.3528 5.08667 78.1349 6.29443 76.6326 6.29443C75.1304 6.29443 73.9125 5.08667 73.9125 3.59682V2.69761Z"
            fill="#98DDAB"
          />
          <path
            d="M64.4054 31.6088C64.9185 31.0705 65.175 30.4126 65.175 29.6351V2.73624C65.175 1.95873 64.9185 1.31579 64.4054 0.807415C63.8923 0.269138 63.2434 0 62.4587 0C61.6739 0 61.025 0.269138 60.5119 0.807415C59.9988 1.31579 59.7423 1.95873 59.7423 2.73624V29.6351C59.7423 30.4126 59.9988 31.0705 60.5119 31.6088C61.025 32.1172 61.6739 32.3714 62.4587 32.3714C63.2434 32.3714 63.8923 32.1172 64.4054 31.6088Z"
            fill="#FFC952"
          />
          <path
            d="M53.8568 10.4665C53.8568 8.98008 55.073 7.77511 56.5732 7.77511H68.0423C69.5425 7.77511 70.7587 8.98008 70.7587 10.4665C70.7587 11.9529 69.5425 13.1579 68.0423 13.1579H56.5732C55.073 13.1579 53.8568 11.9529 53.8568 10.4665Z"
            fill="#FFC952"
          />
          <path
            d="M47.4378 7.73486C48.2163 7.73486 48.8601 7.98933 49.3691 8.49827C49.8782 9.00721 50.1327 9.66584 50.1327 10.4742V29.4696C50.1327 30.248 49.8782 30.9066 49.3691 31.4455C48.8601 31.9544 48.2163 32.2089 47.4378 32.2089C46.6592 32.2089 46.0154 31.9544 45.5064 31.4455C45.0273 30.9365 44.7728 30.2929 44.7428 29.5145C43.9943 30.3827 42.9762 31.1311 41.6886 31.7598C40.431 32.3586 39.0985 32.6579 37.6911 32.6579C35.625 32.6579 33.7536 32.134 32.0767 31.0862C30.3999 30.0085 29.0674 28.5266 28.0793 26.6405C27.1211 24.7544 26.642 22.6139 26.642 20.2189C26.642 17.8238 27.1211 15.6833 28.0793 13.7972C29.0375 11.8812 30.34 10.3993 31.9869 9.3515C33.6637 8.27374 35.5053 7.73486 37.5115 7.73486C38.9488 7.73486 40.2962 8.0043 41.5539 8.54318C42.8115 9.05212 43.8745 9.71075 44.7428 10.5191V10.4742C44.7428 9.69578 44.9974 9.05212 45.5064 8.54318C46.0154 8.0043 46.6592 7.73486 47.4378 7.73486ZM38.3649 27.7182C40.3112 27.7182 41.8982 27.0147 43.1259 25.6076C44.3536 24.1706 44.9674 22.3744 44.9674 20.2189C44.9674 18.0633 44.3536 16.2671 43.1259 14.8301C41.8982 13.3931 40.3112 12.6746 38.3649 12.6746C36.4485 12.6746 34.8764 13.3931 33.6488 14.8301C32.4211 16.2671 31.8072 18.0633 31.8072 20.2189C31.8072 22.3744 32.4061 24.1706 33.6038 25.6076C34.8315 27.0147 36.4185 27.7182 38.3649 27.7182Z"
            fill="#FF7473"
          />
          <path
            d="M12.4416 7.73486C14.5077 7.73486 16.3791 8.27474 18.056 9.35449C19.7328 10.4042 21.0503 11.8739 22.0085 13.7635C22.9967 15.653 23.4907 17.7975 23.4907 20.197C23.4907 22.5964 23.0116 24.7559 22.0534 26.6755C21.0952 28.565 19.7777 30.0497 18.1009 31.1295C16.454 32.1792 14.6274 32.7041 12.6212 32.7041C11.1839 32.7041 9.82149 32.4192 8.53392 31.8493C7.27629 31.2494 6.22826 30.5296 5.38984 29.6898V38.5078C5.38984 39.2876 5.13532 39.9324 4.62628 40.4423C4.11724 40.9822 3.47345 41.2521 2.69492 41.2521C1.91639 41.2521 1.2726 40.9972 0.76356 40.4873C0.25452 39.9774 0 39.3176 0 38.5078V10.9291C0 10.1493 0.25452 9.50445 0.76356 8.99457C0.25452 8.4547 1.91639 8.18476 2.69492 8.18476C3.47345 8.18476 4.11724 8.4547 4.62628 8.99457C5.13532 9.50445 5.38984 10.1493 5.38984 10.9291V11.1091C6.10849 10.2093 7.1116 9.42947 8.39917 8.76962C9.68674 8.07978 11.0342 7.73486 12.4416 7.73486ZM11.7678 27.7552C13.6842 27.7552 15.2562 27.0354 16.4839 25.5957C17.7116 24.1561 18.3255 22.3565 18.3255 20.197C18.3255 18.0375 17.7116 16.2529 16.4839 14.8432C15.2862 13.4036 13.7142 12.6837 11.7678 12.6837C9.82149 12.6837 8.23448 13.4036 7.00679 14.8432C5.77911 16.2529 5.16526 18.0375 5.16526 20.197C5.16526 22.3565 5.77911 24.1561 7.00679 25.5957C8.23448 27.0354 9.82149 27.7552 11.7678 27.7552Z"
            fill="#FE346E"
          />
        </svg>
      </div>

      <div className="flex items-center gap-4">
        <DropdownMenu>
          <DropdownMenuTrigger className="cursor-pointer flex items-center gap-2">
            Open <ChevronDown />
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end">
            {userTeams.map((userTeam) => (
              <DropdownMenuItem key={userTeam.teamId}>
                <Link
                  href={`/team/${userTeam.teamId}`}
                  className="flex items-center">
                  <span className="truncate">{userTeam.team.name}</span>
                </Link>
              </DropdownMenuItem>
            ))}

            <DropdownMenuSeparator />
            <DropdownMenuItem>
              <Link
                href="/new-team"
                className="flex items-center gap-2 text-sm text-muted-foreground">
                <CirclePlus />
                Create New Team
              </Link>
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>

        <DropdownMenu>
          <DropdownMenuTrigger
            asChild
            className="cursor-pointer">
            <Avatar className="w-12 h-12">
              <AvatarImage
                sizes="(140px, 140px)"
                src={user?.image || ''}
                alt={user?.name || ''}
              />
              <AvatarFallback>
                <User className="h-4 w-16" />
              </AvatarFallback>
            </Avatar>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end">
            <DropdownMenuItem className="font-normal">
              <div className="flex flex-col space-y-1">
                <p className="text-sm font-medium leading-none">{user?.name}</p>
                <p className="text-xs leading-none text-muted-foreground">
                  {user?.email}
                </p>
              </div>
            </DropdownMenuItem>
            <DropdownMenuItem
              className="cursor-pointer"
              onClick={() => signOut()}>
              <LogOut className="mr-2 h-4 w-4" />
              <span>Log out</span>
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </div>
    </header>
  );
}
